<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Xmas 2025 Challenge</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: radial-gradient(circle at top, #0b3d2e, #031a13);
    margin: 0;
    padding: 0;
    color: #f8f9fa;
    overflow: hidden;
  }

  header {
    background: linear-gradient(90deg, #b30000, #006400);
    color: #ffd700;
    padding: 25px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
  }

  header h1 {
    margin: 0;
    letter-spacing: 2px;
  }

  .container {
    width: 90%;
    max-width: 500px;
    margin: 60px auto;
    background: rgba(255,255,255,0.95);
    border-radius: 10px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    padding: 30px;
    color: #212529;
    position: relative;
    z-index: 10;
  }

  h3 {
    margin-top: 0;
    text-align: center;
    color: #b30000;
  }

  /* ===== Floating Input Style ===== */
  .input-group {
    position: relative;
    margin: 25px 0;
  }

  .input-group input {
    width: 100%;
    padding: 14px 10px;
    font-size: 1rem;
    border: none;
    border-bottom: 2px solid #bbb;
    outline: none;
    background: transparent;
  }

  .input-group label {
    position: absolute;
    top: 14px;
    left: 10px;
    color: #666;
    font-size: 1rem;
    pointer-events: none;
    transition: 0.2s ease;
  }

  .input-group input:focus {
    border-bottom-color: #006400;
  }

  .input-group input:focus + label,
  .input-group input:not(:placeholder-shown) + label {
    top: -8px;
    font-size: 0.75rem;
    color: #006400;
  }

  button {
    width: 100%;
    padding: 14px;
    background: linear-gradient(90deg, #006400, #00a550);
    border: none;
    color: white;
    font-size: 1.1rem;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 15px;
    font-weight: bold;
    letter-spacing: 1px;
  }

  button:hover {
    background: linear-gradient(90deg, #00a550, #006400);
  }

  #out {
    margin-top: 20px;
    font-weight: bold;
    text-align: center;
    font-size: 1.2rem;
  }

  .footer {
    text-align: center;
    margin-top: 40px;
    font-size: 0.85rem;
    color: #ccc;
    z-index: 10;
    position: relative;
  }

  /* ===== Snow Effect ===== */
  .snowflake {
    position: fixed;
    top: -10px;
    color: white;
    user-select: none;
    pointer-events: none;
    z-index: 1;
    animation: fall linear infinite;
  }

  @keyframes fall {
    0% {
      transform: translateY(0) translateX(0);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) translateX(30px);
      opacity: 0;
    }
  }
</style>
</head>

<body>

<header>
  <h1>üéÑ Holiday ‚Äô25 Capture the Flag üéÑ</h1>
</header>

<div class="container">
  <h3>Enter Found Flags</h3>

  <div class="input-group">
    <input id="flag1" type="text" required placeholder=" ">
    <label>FLAG{challenge one}</label>
  </div>

  <div class="input-group">
    <input id="flag2" type="text" required placeholder=" ">
    <label>FLAG{challenge two}</label>
  </div>

  <div class="input-group">
    <input id="flag3" type="text" required placeholder=" ">
    <label>FLAG{challenge three}</label>
  </div>

  <button onclick="handle()">CHECK FLAGS</button>

  <pre id="out"></pre>
</div>

<div class="footer">
   ‚ùÑ
</div>

<script src="crypto.js"></script>


<script>
/*These are AES‚Äëencrypted strings, encoded in b64 for representation. This way, the user must provide the password (i.e., flag) to decrypt them.
  Truth is, I simply encyrpted the string "True" with the Flag value, to ensure True as a boolean output
  and.. I did not want to do: if (input === "FLAG{...}") -- it would be too easy to find all the flags that way*/

const Flag1 = "E9HKIai3UamrvbAvYJ2oN9IbHf5URde9PjQMEFyG+BaMh8rJlGVhTo9NPVy1CGj/";
const Flag2 = "SLQBs/SEGRibWWvoUc1uMeaoejLSJ6dJVirB7fTMbeIpHhsvlEZPVerhjz39hmLA";
const Flag3 = "ssDPCHGw5aztSnAf0ORHO3hhgNYmndvI9j627K7ZZ4Y4U4SJgn90q0M2OsBcd50f";

async function decryptFlag(base64Data, password) {
  try {
    const combined = Uint8Array.from(atob(base64Data), c => c.charCodeAt(0));
    const salt = combined.slice(0, 16);
    const iv = combined.slice(16, 32);
    const data = combined.slice(32);

    const enc = new TextEncoder();
    const dec = new TextDecoder();

    const keyMaterial = await crypto.subtle.importKey(
      "raw",
      enc.encode(password),
      "PBKDF2",
      false,
      ["deriveKey"]
    );

    const key = await crypto.subtle.deriveKey(
      { name: "PBKDF2", salt: salt, iterations: 10000, hash: "SHA-256" },
      keyMaterial,
      { name: "AES-CBC", length: 256 },
      true,
      ["decrypt"]
    );

    const decrypted = await crypto.subtle.decrypt(
      { name: "AES-CBC", iv: iv },
      key,
      data
    );

    return dec.decode(decrypted);
  } catch (e) {
    return false;
  }
}

async function handle() {
  const inputs = [
    { el: document.getElementById("flag1"), data: Flag1 },
    { el: document.getElementById("flag2"), data: Flag2 },
    { el: document.getElementById("flag3"), data: Flag3 }
  ];

  for (const inputObj of inputs) {
    const { el, data } = inputObj;
    if (!el.dataset.correct) { // only check if not already correct
      const value = el.value;
      const result = await decryptFlag(data, value);
      if (result) {
        el.style.backgroundColor = "#d4edda"; // light green
        el.style.borderColor = "#28a745"; // green border
        el.disabled = true; // lock input
        el.dataset.correct = "true"; // mark as correct
      } else {
        el.style.backgroundColor = "#f8d7da"; // light red
        el.style.borderColor = "#dc3545"; // red border
      }
    }
  }
}
</script>

<script>
/* trigger the Chrismas explosion*/
async function handle() {
  const inputs = [
    { el: document.getElementById("flag1"), data: Flag1 },
    { el: document.getElementById("flag2"), data: Flag2 },
    { el: document.getElementById("flag3"), data: Flag3 }
  ];

  let allCorrect = true;

  for (const inputObj of inputs) {
    const { el, data } = inputObj;
    if (!el.dataset.correct) { // only check if not already correct
      const value = el.value;
      const result = await decryptFlag(data, value);
      if (result) {
        el.style.backgroundColor = "#d4edda"; // light green
        el.style.borderColor = "#28a745"; // green border
        el.disabled = true;
        el.dataset.correct = "true";
      } else {
        el.style.backgroundColor = "#f8d7da"; // light red
        el.style.borderColor = "#dc3545"; // red border
        allCorrect = false;

        setTimeout(() => {
          el.style.backgroundColor = "transparent";
          el.style.borderColor = "#bbb";
        }, 1000);
      }
    }
    if (!el.dataset.correct) allCorrect = false;
  }

  if (allCorrect) {
    triggerChristmasExplosion();
  }
}
</script>


<script>
/* Christmas explosion function */
function triggerChristmasExplosion() {
  const container = document.querySelector(".container");
  const emojis = ["üéÑ","üéÖ","‚ùÑ","üéÅ","‚≠ê","üç¨"];

  for (let i = 0; i < 50; i++) {
    const el = document.createElement("div");
    el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    el.style.position = "fixed";
    el.style.left = Math.random() * 100 + "vw";
    el.style.top = Math.random() * 100 + "vh";
    el.style.fontSize = (20 + Math.random() * 40) + "px";
    el.style.zIndex = 100;
    el.style.opacity = 1;
    el.style.transition = "all 15s ease-out"; // animate for 15 seconds

    document.body.appendChild(el);

    // Animate explosion
    setTimeout(() => {
      el.style.transform = `translate(${(Math.random()-0.5)*200}px, ${(Math.random()-0.5)*200}px) rotate(${Math.random()*360}deg)`;
      el.style.opacity = 0;
    }, 50);

    // Remove element after 15 seconds
    setTimeout(() => el.remove(), 15000); // <-- fix: was 1500
  }

  // Show final message
  const out = document.getElementById("out");
  out.textContent = "üéâ ALL FLAGS CORRECT! HAPPY HOLIDAYS!! üéâ";
}
</script>


<script>
/* Snow generator */
const snowflakeCount = 50;
for (let i = 0; i < snowflakeCount; i++) {
  const snow = document.createElement("div");
  snow.className = "snowflake";
  snow.textContent = "‚ùÑ";
  snow.style.left = Math.random() * 100 + "vw";
  snow.style.animationDuration = (6 + Math.random() * 6) + "s";
  snow.style.fontSize = (10 + Math.random() * 22) + "px";
  snow.style.opacity = Math.random();
  document.body.appendChild(snow);
}
</script>

</body>
</html>
